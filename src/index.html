<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.5/viewer.css"
      integrity="sha512-c7kgo7PyRiLnl7mPdTDaH0dUhJMpij4aXRMOHmXaFCu96jInpKc8sZ2U6lby3+mOpLSSlAndRtH6dIonO9qVEQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css"
    />

    <link rel="stylesheet" href="/css/index.css" />
    <title>Test</title>
  </head>
  <body>
    <div id="main_container" class="container-fluid">
      <div class="d-flex flex-row-reverse">
        <div class="col-1"></div>
        <div class="left col-2 mt-5">
          <div class="row mt-2">
            <!-- NY ARKIVSKAPER / VELG ARKIVSKAPER -->
            <section id="creator">
              <div class="row">
                <div class="col-9 mt-5">
                  <p class="text-white" style="padding: 0; margin: 0">
                    Ny arkivskaper:
                  </p>
                </div>
                <div class="col-9">
                  <input
                    id="creator_name"
                    type="text"
                    class="form-control"
                    style="width: 100%; height: 100%"
                  />
                </div>
                <div class="col-3">
                  <button id="new_creator" class="btn btn-main">
                    <i class="bi bi-plus-circle"></i>
                  </button>
                </div>
                <div class="col-12 mt-5">
                  <p class="text-white" style="padding: 0; margin: 0">
                    Velg arkivskaper:
                  </p>
                  <select id="creatorFolders" class="form-select mb-3">
                    <option class="form-select" value="loading" selected>
                      Loading...
                    </option>
                  </select>
                </div>
              </div>
            </section>
            <!-- NYTT PROSJEKT / VELG PROSJEKT -->
            <section id="project" hidden>
              <div class="row">
                <div class="col-9 mt-5">
                  <p class="text-white" style="padding: 0; margin: 0">
                    Nytt prosjekt:
                  </p>
                </div>
                <div class="col-9">
                  <input
                    id="project_name"
                    type="text"
                    class="form-control"
                    style="width: 100%; height: 100%"
                  />
                </div>
                <div class="col-3">
                  <button id="new_project" class="btn btn-main">
                    <i class="bi bi-plus-circle"></i>
                  </button>
                </div>
                <div class="col-12 mt-5">
                  <p class="text-white" style="padding: 0; margin: 0">
                    Velg prosjekt:
                  </p>
                  <select id="projectFolders" class="form-select mb-3">
                    <option class="form-select" value="1" selected>
                      Loading...
                    </option>
                  </select>
                </div>
              </div>
            </section>
            <!-- CAPTURE IMAGE  -->
            <section id="capture">
              <div class="row">
                <div class="col-12 mt-5">
                  <p class="text-white" style="padding: 0; margin: 0">
                    Arkivserie:
                  </p>
                  <input type="text" id="prefix" class="form-control" />
                  <p
                    id="prefixExample"
                    class="subtitle text-white"
                    style="padding: 0; margin: 0"
                  ></p>
                </div>
                <div class="col-12 mt-5">
                  <button id="capture_image" class="btn btn-main w-100">
                    Take picture
                  </button>
                </div>
              </div>
            </section>
            <!-- SAVE IMAGE? YES / NO -->
            <section id="yes_no_wrapper" hidden>
              <div class="row">
                <div class="col-12 mt-5">
                  <h2 class="text-white text-center">Save image?</h2>
                </div>
                <div class="col-6 mt-1">
                  <button id="save_yes" class="btn btn-main w-100">Yes</button>
                </div>
                <div class="col-6 mt-1">
                  <button id="save_no" class="btn btn-main w-100">No</button>
                </div>
              </div>
            </section>
          </div>
        </div>
        <!-- PICTURE VIEWER -->
        <div class="col-1"></div>
        <div class="right col-8 shadow">
          <div id="image_container">
            <img id="image" src="/icons/video-slash.png" alt="" hidden />
          </div>
        </div>
      </div>
    </div>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.5/viewer.min.js"
      integrity="sha512-i5q29evO2Z4FHGCO+d5VLrwgre/l+vaud5qsVqQbPXvHmD9obORDrPIGFpP2+ep+HY+z41kAmVFRHqQAjSROmA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script
      src="https://code.jquery.com/jquery-3.6.1.min.js"
      integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ="
      crossorigin="anonymous"
    ></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script type="text/javascript">
      const viewer_options = {
        inline: true,
        backdrop: false,
        focus: true,
        fullscreen: true,
        loading: true,
        keyboard: true,
        movable: true,
        navbar: false,
        rotatable: false,
        scalabe: false,
        slideOnTouch: true,
        title: true,
        toggleOnDblclick: true,
        toolbar: false,
        tooltop: true,
        transition: true,
        zoomable: true,
        zoomOnTouch: true,
        zoomOnWheel: true,
        viewed() {
          viewer.zoomTo(0.2);
        },
      };
      const request = async (req, creator, project, prefix) => {
        return await axios
          .get(`/camera/${req}/${creator}/${project}/${prefix}`)
          .then((response) => {
            return response;
          })
          .catch((error) => {
            console.log(error);
          });
      };
      const saver = (yes_no, creator, project) => {
        axios
          .get("/camera/save/" + yes_no + "/" +creator + "/" + project)
          .then((response) => {
            Swal.fire({
              position: "top-end",
              icon: "success",
              title: response.data.message,
              showConfirmButton: false,
              timer: 1500,
            });
          })
          .catch((error) => {
            Swal.fire({
              position: "top-end",
              icon: "error",
              title: response.data.error_message,
              showConfirmButton: false,
              timer: 1500,
            });
          });
      };
    </script>
    <script type="text/javascript">
      $("#prefix").val() === ""
        ? $("#capture_image").attr("disabled", true)
        : $("#capture_image").attr("disabled", false);
      $("#prefix").on("input", () => {
        $("#prefix").val() === ""
          ? $("#capture_image").attr("disabled", true)
          : $("#capture_image").attr("disabled", false);
        $("#prefixExample").html(
          $("#creatorFolders").val() +
            "-" +
            $("#projectFolders").val() +
            "-" +
            $("#prefix").val() +
            "_14-8-2022_#.jpg"
        );
      });

      $("#capture_image").click(async () => {
        const response = await request(
          "capture",
          $("#creatorFolders").val(),
          $("#projectFolders").val(),
          $("#prefix").val()
        );
        console.log(response);
        if (response) {
          //save image?
          $("#yes_no_wrapper").attr("hidden", false);
          $("#save_yes").click((e) => {
            saver("yes", $("#creatorFolders").val(), $("#projectFolders").val());
            $("#yes_no_wrapper").attr("hidden", true);
          });
          $("#save_no").click((e) => {
            saver("no", $("#creatorFolders").val(), $("#projectFolders").val());
            $("#yes_no_wrapper").attr("hidden", true);
          });
          $("#image_container").html(response.data.img);
          const viewer = new Viewer(
            document.getElementById("image"),
            viewer_options
          );
        }
      });

      const viewer = new Viewer(
        document.getElementById("image"),
        viewer_options
      );
    </script>
    <script src="/js/creator.js"></script>
    <script src="/js/project.js"></script>
    <script type="module" src="/js/gui.js"></script>
  </body>
</html>
